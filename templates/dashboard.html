<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        /* ã‚°ãƒ©ãƒ•ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
        #weeklyChart, #subjectChart {
            max-width: 500px; /* æœ€å¤§å¹… */
            height: 300px; /* é«˜ã• */
            margin: auto; /* ä¸­å¤®é…ç½® */
        }

        /* é”æˆç‡ã®å††ã‚°ãƒ©ãƒ•ã‚’å°ã•ãã™ã‚‹ */
        .progress-chart-container {
            width: 150px; /* å°ã•ã‚ã«èª¿æ•´ */
            height: 150px;
            text-align: center;
            margin-bottom: 50px;
        }

        #subjectChartTitle {
            text-align: center;
            font-size: 20px; /* æ–‡å­—ã‚’å¤§ãã */
            font-weight: bold;
            margin-top: 100px; /* ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸Šã«ä½™ç™½ã‚’å¢—ã‚„ã™ */
        }

        #progressChartContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
        #calendar {
            width: 60%;
            max-width: 800px;
            margin: auto;
        }
    </style>
</head>
<body>
    <h1>å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

    <!-- é€±é–“å­¦ç¿’æ™‚é–“ (æ£’ã‚°ãƒ©ãƒ•) -->
    <h2>é€±é–“å­¦ç¿’æ™‚é–“</h2>
    <canvas id="weeklyChart"></canvas>

    <!-- ç§‘ç›®ã”ã¨ã®é”æˆç‡ï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰ -->
    <h2>ç§‘ç›®ã”ã¨ã®é”æˆç‡</h2>
    <div id="progressChartContainer">
        <div class="progress-chart-container">
            <h3>Japanese</h3>
            <canvas id="progressChart-japanese"></canvas>
        </div>
        <div class="progress-chart-container">
            <h3>Math</h3>
            <canvas id="progressChart-math"></canvas>
        </div>
        <div class="progress-chart-container">
            <h3>Science</h3>
            <canvas id="progressChart-science"></canvas>
        </div>
        <div class="progress-chart-container">
            <h3>Physics</h3>
            <canvas id="progressChart-physics"></canvas>
        </div>
        <div class="progress-chart-container">
            <h3>Social</h3>
            <canvas id="progressChart-social"></canvas>
        </div>
        <div class="progress-chart-container">
            <h3>English</h3>
            <canvas id="progressChart-english"></canvas>
        </div>
    </div>

    <!-- å­¦ç¿’çµæœï¼ˆæ•™ç§‘ã”ã¨ã®å­¦ç¿’å‰²åˆï¼‰ -->
    <h2 id="subjectChartTitle">å­¦ç¿’çµæœï¼ˆæ•™ç§‘ã”ã¨ã®å­¦ç¿’å‰²åˆï¼‰</h2>
    <canvas id="subjectChart"></canvas>>

    <!-- å­¦ç¿’å±¥æ­´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
    <h2>å­¦ç¿’å±¥æ­´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
    <div id="calendar"></div>

    <!-- å­¦ç¿’è¨ˆç”»ã®ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="planDetailsModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); z-index: 1000;">
        <h2>å­¦ç¿’è¨ˆç”»ã®è©³ç´°</h2>
        <p id="planDetails"></p>
        <button id="deletePlanButton" style="background-color: red; color: white; padding: 5px 10px; border: none; cursor: pointer;">
            ã“ã®è¨ˆç”»ã‚’å‰Šé™¤
        </button>
        <button id="closePlanButton">é–‰ã˜ã‚‹</button>
    </div>

    <!-- å­¦ç¿’è¨˜éŒ²ã®ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="recordDetailsModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); z-index: 1000;">
        <h2>å­¦ç¿’è¨˜éŒ²ã®è©³ç´°</h2>
        <p id="recordDetails"></p>
        <button id="deleteRecordButton" style="background-color: red; color: white; padding: 5px 10px; border: none; cursor: pointer;">
            ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤
        </button>
        <button id="closeRecordButton">é–‰ã˜ã‚‹</button>
    </div>

    <!-- å­¦ç¿’è¨ˆç”»ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <h2>å­¦ç¿’è¨ˆç”»ã®ç™»éŒ²</h2>
    <form id="studyPlanForm">
        <label for="subject">æ•™ç§‘:</label>
        <select id="subject" name="subject" required>
            <option value="japanese">Japanese</option>
            <option value="math">Math</option>
            <option value="science">Science</option>
            <option value="physics">Physics</option>
            <option value="social">Social</option>
            <option value="english">English</option>
        </select><br>

        <label for="selected_day">æ›œæ—¥:</label>
        <select id="selected_day" name="selected_day" required>
            <option value="Monday">æœˆæ›œæ—¥</option>
            <option value="Tuesday">ç«æ›œæ—¥</option>
            <option value="Wednesday">æ°´æ›œæ—¥</option>
            <option value="Thursday">æœ¨æ›œæ—¥</option>
            <option value="Friday">é‡‘æ›œæ—¥</option>
            <option value="Saturday">åœŸæ›œæ—¥</option>
            <option value="Sunday">æ—¥æ›œæ—¥</option>
        </select><br>

        <label for="goal_time">ç›®æ¨™æ™‚é–“ï¼ˆåˆ†ï¼‰:</label>
        <input type="number" id="goal_time" name="goal_time" required><br>

        <button type="submit">å­¦ç¿’è¨ˆç”»ã‚’ç™»éŒ²</button>
    </form>

    <h2>å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²</h2>
    <form id="studyRecordForm">
        <label for="record_subject">æ•™ç§‘:</label>
        <select id="record_subject" name="subject" required>
            <option value="japanese">Japanese</option>
            <option value="math">Math</option>
            <option value="science">Science</option>
            <option value="physics">Physics</option>
            <option value="social">Social</option>
            <option value="english">English</option>
        </select><br>

        <label for="record_date">æ—¥ä»˜:</label>
        <input type="date" id="record_date" name="record_date" required><br>

        <label for="study_time">å­¦ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰:</label>
        <input type="number" id="study_time" name="study_time" required><br>

        <button type="submit">å­¦ç¿’è¨˜éŒ²ã‚’ç™»éŒ²</button>
    </form>


    <h2>ãƒ¡ãƒ¢ã®ç™»éŒ²</h2>
    <form id="studyNoteForm">
        <label for="note_date">æ—¥ä»˜:</label>
        <input type="date" id="note_date" name="note_date" required><br>

        <label for="note_content">ãƒ¡ãƒ¢å†…å®¹:</label>
        <textarea id="note_content" name="note_content" required></textarea><br>

        <button type="submit">ãƒ¡ãƒ¢ã‚’ç™»éŒ²</button>
    </form>

    <h2>ç™»éŒ²ã•ã‚ŒãŸãƒ¡ãƒ¢</h2>
    <ul id="studyNoteList"></ul>



    <script>
        // é€±é–“å­¦ç¿’æ™‚é–“ï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰
        fetch('/api/stats/weekly/1')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('weeklyChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(item => item.date),
                        datasets: [{
                            label: 'å­¦ç¿’æ™‚é–“ (åˆ†)',
                            data: data.map(item => item.total_time),
                            backgroundColor: 'rgba(54, 162, 235, 0.5)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,  // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒ
                    }
                });
            });

        // ç§‘ç›®ã”ã¨ã®é”æˆç‡ï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰
        fetch('/api/stats/progress/1')
            .then(response => response.json())
            .then(data => {
                data.forEach(subjectData => {
                    const ctx = document.getElementById(`progressChart-${subjectData.subject}`).getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ["é”æˆ", "æœªé”æˆ"],
                            datasets: [{
                                data: [subjectData.progress, 100 - subjectData.progress],
                                backgroundColor: ["green", "lightgray"]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true
                        }
                    });
                });
            })
            .catch(error => console.error("é”æˆç‡ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error));

        // å­¦ç¿’çµæœï¼ˆæ•™ç§‘ã”ã¨ã®å­¦ç¿’å‰²åˆï¼‰
        fetch('/api/stats/subject_distribution/1')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('subjectChart').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: data.map(item => item.subject),
                        datasets: [{
                            data: data.map(item => item.total_time),
                            backgroundColor: ['red', 'blue', 'green', 'yellow', 'purple']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true
                    }
                });
            })
            .catch(error => console.error("APIå–å¾—ã‚¨ãƒ©ãƒ¼:", error));

        // å­¦ç¿’å±¥æ­´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
        let selectedPlanId = null; // é¸æŠã•ã‚ŒãŸå­¦ç¿’è¨ˆç”»ID
        let selectedRecordId = null; // é¸æŠã•ã‚ŒãŸå­¦ç¿’è¨˜éŒ²ID

        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: [],
                eventClick: function (info) {
                    console.log("ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆ:", info.event);

                    if (info.event.backgroundColor === "red") {
                        selectedPlanId = info.event.extendedProps.plan_id || null;
                        document.getElementById('planDetails').textContent = info.event.title;
                        document.getElementById('planDetailsModal').style.display = "block";
                    } else if (info.event.backgroundColor === "blue") {
                        selectedRecordId = info.event.extendedProps.record_id || null;
                        document.getElementById('recordDetails').textContent = info.event.title;
                        document.getElementById('recordDetailsModal').style.display = "block";
                    }
                }
            });

            function fetchCalendarData() {
                fetch('/api/stats/calendar/1')
                    .then(response => response.json())
                    .then(data => {
                        const studyRecords = data.map(item => ({
                            title: item.title,
                            start: item.start,
                            color: item.color,
                            extendedProps: item.color === "blue" ? { record_id: item.record_id } : { plan_id: item.plan_id }
                        }));

                        calendar.removeAllEvents();
                        calendar.addEventSource(studyRecords);
                        calendar.render();
                    })
                    .catch(error => console.error("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
            }

            fetchCalendarData();

            // ğŸ“Œ å­¦ç¿’å±¥æ­´ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ãƒ¡ãƒ¢ã‚’è¡¨ç¤º
            function fetchCalendarNotes() {
                fetch('/api/stats/calendar_notes/1')
                    .then(response => response.json())
                    .then(data => {
                        const calendarEl = document.getElementById('calendar');
                        const calendar = new FullCalendar.Calendar(calendarEl, {
                            initialView: 'dayGridMonth',
                            events: data,  // å–å¾—ã—ãŸãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
                            eventClick: function (info) {
                                if (info.event.backgroundColor === "gray") {
                                    alert(`ãƒ¡ãƒ¢ã®å†…å®¹:\n${info.event.title}`);
                                }
                            }
                        });

                        calendar.render();
                    })
                    .catch(error => console.error("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
            }

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
            fetchCalendarNotes();

            // è¨ˆç”»å‰Šé™¤å‡¦ç†
            document.getElementById("deletePlanButton").addEventListener("click", function () {
                if (!selectedPlanId) {
                    alert("å‰Šé™¤ã™ã‚‹è¨ˆç”»ã® ID ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
                    return;
                }

                fetch(`/api/study_plans/${selectedPlanId}`, { method: "DELETE" })
                    .then(response => {
                        if (!response.ok) throw new Error("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
                        return response.json();
                    })
                    .then(() => {
                        alert("å­¦ç¿’è¨ˆç”»ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼");
                        document.getElementById('planDetailsModal').style.display = "none";
                        fetchCalendarData();
                        fetchStudyPlans();
                    })
                    .catch(error => {
                        console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", error);
                        alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    });
            });

            // å­¦ç¿’è¨˜éŒ²å‰Šé™¤å‡¦ç†
            document.getElementById("deleteRecordButton").addEventListener("click", function () {
                if (!selectedRecordId) {
                    alert("å‰Šé™¤ã™ã‚‹è¨˜éŒ²ã® ID ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
                    return;
                }

                fetch(`/api/study_records/${selectedRecordId}`, { method: "DELETE" })
                    .then(response => {
                        if (!response.ok) throw new Error("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
                        return response.json();
                    })
                    .then(() => {
                        alert("å­¦ç¿’è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼");
                        document.getElementById('recordDetailsModal').style.display = "none";
                        fetchCalendarData();
                        fetchWeeklyStats();
                        fetchSubjectDistribution();
                        fetchProgressStats();
                    })
                    .catch(error => {
                        console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", error);
                        alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    });
            });

            fetchCalendarData();
        });

        function fetchWeeklyStats() {
            fetch('/api/stats/weekly/1')
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('weeklyChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.map(item => item.date),
                            datasets: [{
                                label: 'å­¦ç¿’æ™‚é–“ (åˆ†)',
                                data: data.map(item => item.total_time),
                                backgroundColor: 'rgba(54, 162, 235, 0.5)'
                            }]
                        }
                    });
                });
        }

        function fetchProgressStats() {
            fetch('/api/stats/progress/1')
                .then(response => response.json())
                .then(data => {
                    data.forEach(subjectData => {
                        const ctx = document.getElementById(`progressChart-${subjectData.subject}`).getContext('2d');
                        new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ["é”æˆ", "æœªé”æˆ"],
                                datasets: [{
                                    data: [subjectData.progress, 100 - subjectData.progress],
                                    backgroundColor: ["green", "lightgray"]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true
                            }
                        });
                    });
                })
                .catch(error => console.error("é”æˆç‡ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
        }

        function fetchSubjectDistribution() {
            fetch('/api/stats/subject_distribution/1')
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('subjectChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: data.map(item => item.subject),
                            datasets: [{
                                data: data.map(item => item.total_time),
                                backgroundColor: ['red', 'blue', 'green', 'yellow', 'purple']
                            }]
                        }
                    });
                })
                .catch(error => console.error("å­¦ç¿’å‰²åˆã®å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
        }

        function fetchStudyPlans() {
            fetch("/api/study_plans/1")
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById("studyPlanList");
                    list.innerHTML = "";
                    data.forEach(plan => {
                        const item = document.createElement("li");
                        item.textContent = `${plan.subject} - ç›®æ¨™ ${plan.goal_time} åˆ†`;
                        list.appendChild(item);
                    });
                })
                .catch(error => console.error("å­¦ç¿’è¨ˆç”»å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
        }

        document.getElementById("studyPlanForm").addEventListener("submit", function (event) {
            event.preventDefault();
            console.log("ğŸ“Œ ç™»éŒ²ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");

            const selectedDayElement = document.getElementById("selected_day");
            if (!selectedDayElement) {
                console.error("âŒ selected_day ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
                alert("æ›œæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            console.log("âœ… selected_day:", selectedDayElement.value);

            const formData = {
                user_id: 1,
                subject: document.getElementById("subject").value,
                selected_day: selectedDayElement.value,
                goal_time: parseInt(document.getElementById("goal_time").value),
                weekly_schedule: {
                    Monday: parseInt(document.getElementById("mon")?.value) || 0,
                    Tuesday: parseInt(document.getElementById("tue")?.value) || 0,
                    Wednesday: parseInt(document.getElementById("wed")?.value) || 0,
                    Thursday: parseInt(document.getElementById("thu")?.value) || 0,
                    Friday: parseInt(document.getElementById("fri")?.value) || 0,
                    Saturday: parseInt(document.getElementById("sat")?.value) || 0,
                    Sunday: parseInt(document.getElementById("sun")?.value) || 0
                }
            };

            console.log("ğŸ“Œ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:", formData);

            fetch("/api/study_plans", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    console.log("ğŸ“Œ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹:", response);
                    if (!response.ok) {
                        throw new Error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("ğŸ“Œ ç™»éŒ²æˆåŠŸ:", data);
                    alert("å­¦ç¿’è¨ˆç”»ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼");

                    // ç™»éŒ²æˆåŠŸå¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
                    fetchStudyPlans();
                    fetchCalendarData();
                    fetchWeeklyStats();
                    fetchProgressStats();
                    fetchSubjectDistribution();
                })
                .catch(error => {

                });
        });

        document.getElementById("studyRecordForm").addEventListener("submit", function (event) {
            event.preventDefault();
            console.log("ğŸ“Œ å­¦ç¿’è¨˜éŒ²ã®ç™»éŒ²ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");

            const formData = {
                user_id: 1, // ä»®ã®å€¤ï¼ˆå®Ÿéš›ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ã™ã‚‹ï¼‰
                subject: document.getElementById("record_subject").value,
                record_date: document.getElementById("record_date").value,
                study_time: parseInt(document.getElementById("study_time").value)
            };

            fetch("/api/study_records", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (!response.ok) throw new Error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼");
                    return response.json();
                })
                .then(data => {
                    console.log("ğŸ“Œ ç™»éŒ²æˆåŠŸ:", data);
                    alert("å­¦ç¿’è¨˜éŒ²ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼");
                    fetchStudyRecords();
                })
                .catch(error => {
                    console.error("âŒ ç™»éŒ²ã‚¨ãƒ©ãƒ¼:", error);
                    alert("ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                });
        });

        function fetchStudyRecords() {
            fetch("/api/study_records/1")
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById("studyRecordList");
                    list.innerHTML = "";
                    data.forEach(record => {
                        const item = document.createElement("li");
                        item.textContent = `${record.record_date} - ${record.subject} - ${record.study_time} åˆ†`;

                        // å‰Šé™¤ãƒœã‚¿ãƒ³
                        const deleteButton = document.createElement("button");
                        deleteButton.textContent = "å‰Šé™¤";
                        deleteButton.onclick = function () {
                            deleteStudyRecord(record.id);
                        };

                        item.appendChild(deleteButton);
                        list.appendChild(item);
                    });
                })
                .catch(error => console.error("å­¦ç¿’è¨˜éŒ²å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
        }

        function deleteStudyRecord(recordId) {
            fetch(`/api/study_records/${recordId}`, { method: "DELETE" })
                .then(response => {
                    if (!response.ok) throw new Error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼");
                    return response.json();
                })
                .then(() => {
                    alert("å­¦ç¿’è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼");
                    fetchStudyRecords();
                })
                .catch(error => console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", error));
        }

        // å­¦ç¿’è¨ˆç”»ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closePlanDetails() {
            document.getElementById('planDetailsModal').style.display = "none";
        }

        // å­¦ç¿’è¨˜éŒ²ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeRecordDetails() {
            document.getElementById('recordDetailsModal').style.display = "none";
        }

        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("closePlanButton").addEventListener("click", closePlanDetails);
            document.getElementById("closeRecordButton").addEventListener("click", closeRecordDetails);
            // ğŸ“Œ ãƒ¡ãƒ¢ã®ä¿å­˜å‡¦ç†
            const studyNoteForm = document.getElementById("studyNoteForm");
            if (studyNoteForm) {
                studyNoteForm.addEventListener("submit", function (event) {
                    event.preventDefault();
                    console.log("ğŸ“Œ ãƒ¡ãƒ¢ã®ä¿å­˜ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸï¼");

                    const formData = {
                        user_id: 1, // ä»®ã®å€¤ï¼ˆå®Ÿéš›ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ã™ã‚‹ï¼‰
                        study_date: document.getElementById("note_date").value,
                        content: document.getElementById("note_content").value
                    };

                    fetch("/api/study_notes", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("ğŸ“Œ ãƒ¡ãƒ¢ä¿å­˜æˆåŠŸ:", data);
                            alert("ãƒ¡ãƒ¢ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
                            fetchStudyNotes();
                            fetchCalendarNotes(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                        })
                        .catch(error => console.error("âŒ ãƒ¡ãƒ¢ä¿å­˜ã‚¨ãƒ©ãƒ¼:", error));
                });
            }

            // ğŸ“Œ ãƒ¡ãƒ¢ä¸€è¦§ã®å–å¾—
            function fetchStudyNotes() {
                fetch("/api/study_notes/1")  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID 1 ã®ãƒ¡ãƒ¢ã‚’å–å¾—
                    .then(response => response.json())
                    .then(data => {
                        const list = document.getElementById("studyNoteList");
                        if (!list) {
                            console.error("âŒ 'studyNoteList' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
                            return;
                        }

                        list.innerHTML = "";  // ä¸€æ—¦ã‚¯ãƒªã‚¢
                        data.forEach(note => {
                            const item = document.createElement("li");
                            item.textContent = `${note.study_date}: ${note.content} `;

                            // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
                            const deleteButton = document.createElement("button");
                            deleteButton.textContent = "å‰Šé™¤";
                            deleteButton.style.marginLeft = "10px";
                            deleteButton.onclick = function () {
                                deleteStudyNote(note.id);
                            };

                            item.appendChild(deleteButton);
                            list.appendChild(item);
                        });
                    })
                    .catch(error => console.error("âŒ ãƒ¡ãƒ¢å–å¾—ã‚¨ãƒ©ãƒ¼:", error));
            }

            // ğŸ“Œ ãƒ¡ãƒ¢å‰Šé™¤å‡¦ç†
            function deleteStudyNote(noteId) {
                console.log(`ğŸ—‘ï¸ å‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡: /api/study_notes/${noteId}`);

                fetch(`/api/study_notes/${noteId}`, { method: "DELETE" })
                    .then(response => {
                        if (!response.ok) throw new Error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼");
                        return response.json();
                    })
                    .then(() => {
                        alert("ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼");
                        fetchStudyNotes();    // ãƒ¡ãƒ¢ä¸€è¦§ã‚’æ›´æ–°
                        fetchCalendarNotes(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
                    })
                    .catch(error => console.error("âŒ ãƒ¡ãƒ¢å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", error));
            }

            // åˆå›ãƒ¡ãƒ¢å–å¾—
            fetchStudyNotes();
;
        });

    </script>
</body>
</html>